(template function_application
          (id identifier)
          (state process:id)
          (recomputable bool)
          (recompute_penalty real)
          )

;; Generic tables:
(table process
       (id   identifier)
       (inserted   timestamp)
       (requested  timestamp)
       (started    timestamp)
       (completed  timestamp)
       (status     text) ;; Should be a variant?
)

(table note
       (id         identifier)
       (note       text not_null))

(table file ;;Static files
       (id identifier)
       (path text)
       (size integer)
       (type text)
)

;; Runtime Values:
(template value
          (id identifier)
          (last_accessed timestamp)
          )
(value int_value
       (val integer)
       )
(value real_value
       (val real)
       )
(value string_value
       (val text)
       )
(value file_value
       (path text)
       (type text)
       (size integer)
       )


;; Almost static input data:
(table person
       (id              identifier)
       (print_name      text)
       (family_name     text not_null)
       (email           text not_null)
       (note            note:id)
)

(table organism
       (id   identifier)
       (name text unique not_null)
       (note            note:id)
)

(table sample
       (id           identifier)
       (name1        text unique not_null)
       (name2        text)
       (organism     organism:id not_null)
       (note            note:id)
);

(table BIOO_barcode
       (id integer)
       (barcode text)
       )
(table TruSeq_barcode
       (id integer)
       (barcode text)
       )

(table protocol
       (id identifier)
       (pdf file:id))

;; Functions:


(function_application library_preparation
                      (sample_id      sample:id)
                      (protocol protocol:id)
                      (submitted_spreadsheet file:id)
                      (result library_value:id)
                      )

(value library_value                  
       (investigator person:id not_null)
       (contacts     person:id array)
       (vial_id        integer unique not_null)
       (name           text unique not_null)
       (application    text)
       (stranded       bool)
       (control_type   text)
       (truseq_control bool)
       (rnaseq_control text)
       (bioo_barcodes BIOO_barcode:id array)
       (truseq_barcodes TruSeq_barcode:id array)
       (read_type      text)
       (read_length1   integer not_null)
       (read_length2   integer)
       )

(value lane_value
       (with_phix bool)
       (libraries library_value:id array)
       (lane lane_value:id)
       )

(function_application lane_mix
                      (libraries library_value:id array)
                      (lane lane_value:id)
                      )

(function_application flowcell_preparation
                      (unique_name text)
                      (lanes library_value:id array)
)
(value flowcell_value
       (unique_name text)
       (lanes library_value:id array)
       )

(function_application qpcr
                      (library library_value:id)
                      (concentration real)
                      (volume real))

(function_application bioanalyzer
                      (library library_value:id)
                      (pdf file_value:id)
                      (well_number int_value:id)
                      (mean_fragment_size real_value:id))

(function_application agarose_gel
                      (library library_value:id)
                      (pdf file_value:id)
                      (well_number int_value:id)
                      (mean_fragment_size  real_value:id))

(function_application hiseq_run
                      (flowcell flowcell_value:id)
                      (raw_data file_value:id))

(function_application sample_sheet
                      (kind text) ;; All barcodes or not
                      (flowcell flowcell_value:id)
                      (csv_file file_value:id)
)

(function_application bcl_to_fastq
                      (mismatch integer)
                      (version text)
                      (sample_sheet file_value:id)
                      (unaligned file_value:id)
                      )

(function_application library_fastqs
                      (unaligned file_value:id)
                      (library library_value:id)
                      (output_dir file_value:id)
                      )
(function_application library_fastx_stats
                      (library_fastqs file_value:id)
                      (other_param integer)
                      (stats file_value:id)
                      )

